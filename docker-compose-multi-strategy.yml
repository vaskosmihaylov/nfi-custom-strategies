---
# Optimized Multi-Strategy Freqtrade Docker Compose Configuration
# Uses system NGINX instead of Docker NGINX for better performance

x-common-settings:
  &common-settings
  image: freqtradeorg/freqtrade:stable
  build:
    context: .
    dockerfile: "./docker/Dockerfile.custom"
  restart: unless-stopped
  volumes:
    - "./user_data:/freqtrade/user_data"
    - "./user_data/data:/freqtrade/user_data/data"
    - "./configs:/freqtrade/configs"
    - "./user_data/strategies:/freqtrade/user_data/strategies"
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:8081"]
    interval: 1m30s
    timeout: 10s
    retries: 3
    start_period: 40s
    start_interval: 5s

services:
  # Original NFI Strategy (keeping existing setup)
  freqtrade-nfi:
    <<: *common-settings
    container_name: ${FREQTRADE__BOT_NAME:-Example_Test_Account}_${FREQTRADE__EXCHANGE__NAME:-bybit}_${FREQTRADE__TRADING_MODE:-futures}-${FREQTRADE__STRATEGY:-NostalgiaForInfinityX6}
    ports:
      - "127.0.0.1:8080:${FREQTRADE__API_SERVER__LISTEN_PORT:-8080}"
    env_file:
      - path: ./env-files/nfi.env
        required: false
    volumes:
      - "./user_data:/freqtrade/user_data"
      - "./user_data/data:/freqtrade/user_data/data"
      - "./configs:/freqtrade/configs"
      - "./${FREQTRADE__STRATEGY:-NostalgiaForInfinityX6}.py:/freqtrade/${FREQTRADE__STRATEGY:-NostalgiaForInfinityX6}.py"
    command: >
      trade
      --config user_data/strategies/config.json
      --db-url sqlite:////freqtrade/user_data/${FREQTRADE__BOT_NAME:-Example_Test_Account}_${FREQTRADE__EXCHANGE__NAME:-bybit}_${FREQTRADE__TRADING_MODE:-futures}-tradesv3.sqlite
      --log-file user_data/logs/${FREQTRADE__BOT_NAME:-Example_Test_Account}-${FREQTRADE__EXCHANGE__NAME:-bybit}-${FREQTRADE__STRATEGY:-NostalgiaForInfinityX6}-${FREQTRADE__TRADING_MODE:-futures}.log
      --strategy-path .

  # BandtasticFiboHyper Strategy
  freqtrade-bandtastic:
    <<: *common-settings
    container_name: Vasko_BandtasticFiboHyper_bybit_futures-BandtasticFiboHyper
    ports:
      - "127.0.0.1:8081:8081"
    env_file:
      - path: ./env-files/bandtastic-fiboHyper.env
        required: true
    command: >
      trade
      --config user_data/strategies/config.json
      --db-url sqlite:////freqtrade/user_data/Vasko_BandtasticFiboHyper_bybit_futures-tradesv3.sqlite
      --log-file user_data/logs/Vasko_BandtasticFiboHyper-bybit-BandtasticFiboHyper-futures.log
      --strategy-path user_data/strategies/BandtasticFiboHyper

  # FastSuperTrend Strategy
  # freqtrade-fastsupertrend:
  #   <<: *common-settings
  #   container_name: Vasko_FastSuperTrend_bybit_futures-fastsupertrend
  #   ports:
  #     - "127.0.0.1:8082:8082"
  #   env_file:
  #     - path: ./env-files/fastsupertrend.env
  #       required: true
  #   command: >
  #     trade
  #     --config user_data/strategies/config.json
  #     --db-url sqlite:////freqtrade/user_data/Vasko_FastSuperTrend_bybit_futures-tradesv3.sqlite
  #     --log-file user_data/logs/Vasko_FastSuperTrend-bybit-fastsupertrend-futures.log
  #     --strategy-path user_data/strategies/fastsupertrend

  # FVGAdvancedStrategy_V2
  freqtrade-fvgadvanced:
    <<: *common-settings
    container_name: Vasko_FVGAdvanced_bybit_futures-FVGAdvancedStrategy_V2
    ports:
      - "127.0.0.1:8083:8083"
    env_file:
      - path: ./env-files/fvgadvanced.env
        required: true
    command: >
      trade
      --config user_data/strategies/config.json
      --db-url sqlite:////freqtrade/user_data/Vasko_FVGAdvanced_bybit_futures-tradesv3.sqlite
      --log-file user_data/logs/Vasko_FVGAdvanced-bybit-FVGAdvancedStrategy_V2-futures.log
      --strategy-path user_data/strategies/FVGAdvancedStrategy_V2

  # PowerTower Strategy
  freqtrade-powertower:
    <<: *common-settings
    container_name: Vasko_PowerTower_bybit_futures-powertower
    ports:
      - "127.0.0.1:8084:8084"
    env_file:
      - path: ./env-files/powertower.env
        required: true
    command: >
      trade
      --config user_data/strategies/config.json
      --db-url sqlite:////freqtrade/user_data/Vasko_PowerTower_bybit_futures-tradesv3.sqlite
      --log-file user_data/logs/Vasko_PowerTower-bybit-powertower-futures.log
      --strategy-path user_data/strategies/powertower

  # TrendFollowing Strategy
  freqtrade-trendfollowing:
    <<: *common-settings
    container_name: Vasko_TrendFollowing_bybit_futures-trendfollowing
    ports:
      - "127.0.0.1:8085:8085"
    env_file:
      - path: ./env-files/trendfollowing.env
        required: true
    command: >
      trade
      --config user_data/strategies/config.json
      --db-url sqlite:////freqtrade/user_data/Vasko_TrendFollowing_bybit_futures-tradesv3.sqlite
      --log-file user_data/logs/Vasko_TrendFollowing-bybit-trendfollowing-futures.log
      --strategy-path user_data/strategies/trendfollowing

  # AdaptiveRenkoStrategy Strategy
  freqtrade-adaptiverenko:
    <<: *common-settings
    container_name: Vasko_AdaptiveRenkoStrategy_bybit_futures-AdaptiveRenko
    ports:
      - "127.0.0.1:8086:8086"
    env_file:
      - path: ./env-files/adaptiverenkostrategy.env
        required: true
    command: >
      trade
      --config user_data/strategies/config.json
      --db-url sqlite:////freqtrade/user_data/Vasko_AdaptiveRenkoStrategy_bybit_futures-tradesv3.sqlite
      --log-file user_data/logs/Vasko_AdaptiveRenkoStrategy-bybit-AdaptiveRenko-futures.log
      --strategy-path user_data/strategies/renko

  # QuickAdapter Strategy
  freqtrade-quickadapter:
    <<: *common-settings
    container_name: Vasko_QuickAdapter_bybit_futures-QuickAdapter
    ports:
      - "127.0.0.1:8087:8087"
    env_file:
      - path: ./env-files/quickadapter.env
        required: true
    command: >
      trade
      --config user_data/strategies/config.json
      --config configs/freqai-quickadapter.json
      --db-url sqlite:////freqtrade/user_data/Vasko_QuickAdapter_bybit_futures-tradesv3.sqlite
      --log-file user_data/logs/Vasko_QuickAdapter-bybit-QuickAdapter-futures.log
      --strategy-path user_data/strategies/quickadapter    

networks:
  default:
    driver: bridge
    name: freqtrade-multi-strategy